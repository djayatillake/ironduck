# LATERAL join tests

statement ok
CREATE TABLE users (id INTEGER, name VARCHAR);

statement ok
INSERT INTO users VALUES (1, 'Alice'), (2, 'Bob'), (3, 'Carol');

statement ok
CREATE TABLE orders (id INTEGER, user_id INTEGER, amount INTEGER);

statement ok
INSERT INTO orders VALUES (1, 1, 100), (2, 1, 200), (3, 2, 150);

# LATERAL with explicit LATERAL keyword
query IIT
SELECT u.id, u.name, o.total FROM users u, LATERAL (SELECT SUM(amount) as total FROM orders WHERE user_id = u.id) o ORDER BY u.id;
----
1
Alice
300
2
Bob
150
3
Carol
NULL

# LATERAL with join syntax
query IIT
SELECT u.id, u.name, o.cnt FROM users u LEFT JOIN LATERAL (SELECT COUNT(*) as cnt FROM orders WHERE user_id = u.id) o ON true ORDER BY u.id;
----
1
Alice
2
2
Bob
1
3
Carol
0

